@using DeVesen.Bazaar.Client.Components.Common.Buttons
@using DeVesen.Bazaar.Client.Models

<MudCard Outlined Elevation="4" Style="width: 350px;">
    <MudCardHeader>
        <CardHeaderAvatar>
            <MudAvatar Color="Color.Secondary">€</MudAvatar>
        </CardHeaderAvatar>
        <CardHeaderContent>
            <MudText Typo="Typo.subtitle1">Auszahlung</MudText>
        </CardHeaderContent>
    </MudCardHeader>
    <MudCardContent>
        <OverviewOfRefundsTable OpenSales="@OpenSales"
                                ShareOfSales="@ShareOfSales"
                                ArticleCommission="@ArticleCommission" />
    </MudCardContent>
    <MudCardActions>
        <DvButtonPayOut  />
    </MudCardActions>
</MudCard>

@code {

    private double OpenSales => Articles.Where(p => p.IsSold() && p.IsSettled() is false)
        .Sum(p => p.SoldAt ?? 0.0d);
    private double ShareOfSales => OpenSales * SalesShare;
    private double ArticleCommission => Articles.Count(p => p.IsReturned() && p.IsSettled() is false) * OfferUnitPrice;

    [Parameter, EditorRequired]
    public required IEnumerable<Article> Articles { get; set; }

    [Parameter, EditorRequired]
    public double SalesShare { get; set; }

    [Parameter, EditorRequired]
    public double OfferUnitPrice { get; set; }
}
